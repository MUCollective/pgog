---
title: "Icon array"
author: "Vignette Author"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

library(magrittr)
library(tidyverse)
library(devtools)
library(gginnards)
library(grid)
```

And adjust the ggplot theme to not draw a bunch of things we don't need for the risk characterization theaters:

```{r ggplot_theme}
theme_set(theme_minimal() +
    theme(
      panel.grid = element_blank()
    )
  )
```

# The manual way

Starting from code from risk theatre

```{r}
N = 100
width = sqrt(N)
height = sqrt(N)
margin = 0.01

x = seq(0, 1, length.out = width + 1)
y = seq(0, 1, length.out = height + 1)

plan = data.frame(
  xleft = x[-length(x)] + margin,
  xright = x[-1] - margin
)

df <- plan %>%
  group_by(xleft, xright) %>%
  do(
    data.frame(
      ybottom = y[-length(y)] + margin,
      ytop = y[-1] - margin
    )) %>%
  ungroup()

```


```{r}
df %>%
  ggplot(aes(xmin = xleft, xmax = xright, ymin = ybottom, ymax = ytop)) +
  geom_rect(color = "lightsteelblue1", fill = NA, size = 0.5) +
  geom_rect(color = "skyblue1", fill = "skyblue1", data = slice(df,1:11)) +
  geom_rect(color = "chartreuse3", fill = "chartreuse3", data = slice(df,12:25)) +
  coord_fixed()
```


# geom_icon

## width <- P(A)


```{r}
cancer %>%
  ggplot() + 
  geom_icon(aes( width = P(test),
                 color = test),
            position = "array") + 
  coord_fixed()
```


## width <- P(A|B)


```{r}
data("cancer")
```

```{r}
cancer %>%
  ggplot() + 
  geom_icon(aes( #x = P(cancer | !test),
                 height = P(cancer | !test),
                 color = cancer),
            position = "array") +
  
  coord_fixed()
```


## x <- A, width <- P(A), position = array


```{r}
cancer %>%
  ggplot() +
  geom_icon(aes(x = factor(test),
                height = P(cancer),
                color = cancer,
                size = 10
  ), position = "array")

```



## x <- A, width <- P(A), position = stack

Hmmm there might be something wrong with this one

```{r}
cancer %>%
  ggplot() +
  geom_icon(aes(x = factor(test),
                height = P(cancer),
                color = cancer,
                size = 10,
                shape = "1"
  ), position = "stack") 
```



 kaput
```{r}
# cancer %>%
#   ggplot() +
#   geom_icon(aes(y = factor(test),
#                 width = P(test),
#                 color = test,
#                 size = 10
#   ), position = "array") 
```



## x <- A, y <- B, w = P(,)

```{r}
ggplot(data=cancer) + 
  geom_icon(aes(x = factor(test), # hack to get the coloring right
                y = cancer, 
                height = P(test),
                color = test,
                size = 10),
            position = "array")
```




# Debugging

https://cran.r-project.org/web/packages/gginnards/vignettes/user-guide-1.html

```{r}
str(ggplot(cancer) + 
  geom_icon(aes(width = P(cancer | test))))
```




```{r}
ggplot(cancer, aes(x = P(cancer | test), y = P(cancer | test))) + 
    geom_debug()
```














